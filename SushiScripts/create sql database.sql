CREATE DATABASE SushiDB

GO
USE SushiDB
GO

CREATE TABLE HOADON
(
    MAHOADON CHAR(10),
    GIOLAP TIME,
    NGAYLAP DATE,
    VAT FLOAT,
    TIENKHACHDUA FLOAT,
    TRANGTHAI NVARCHAR(20),
    PHUONGTHUC NVARCHAR(20),
    BACTHETHANHVIEN CHAR(10),
    MAKHUYENMAI CHAR(10),

	CONSTRAINT PK_HOADON
    PRIMARY KEY (MAHOADON)
)
CREATE TABLE DONDATMON
(
    MADON CHAR(10),
    GIODAT TIME,
    NGAYDAT DATE,
    TRANGTHAI NVARCHAR(20),
    HOADONLIENQUAN CHAR(10),
    KHACHHANGDAT CHAR(10),
    MADATCHO CHAR(10),
    CHINHANHDAT CHAR(10), 
    NHANVIENTAOLAP CHAR(10),

    CONSTRAINT PK_DONDATMON
    PRIMARY KEY (MADON)
)
CREATE TABLE DATHANGTRUCTUYEN
(
    MADHTRUCTUYEN CHAR(10),
    THOIGIANGIAO TIME,
    DIACHIGIAO NVARCHAR(100),
    TRANGTHAI NVARCHAR(20),

    CONSTRAINT PK_DATHANGTRUCTUYEN
    PRIMARY KEY (MADHTRUCTUYEN)
)
CREATE TABLE DATHANGTAICHO
(
    MADHTAICHO CHAR(10),
    MACHINHANH CHAR(10),
    SOBAN CHAR(10),

    CONSTRAINT PK_DATHANGTAICHO
    PRIMARY KEY (MADHTAICHO)
)
CREATE TABLE CHINHANH
(
	MACHINHANH CHAR(10),
	TENCHINHANH NVARCHAR(50),
	DIACHI NVARCHAR(100),
	KHUVUC NVARCHAR(50),
	THOIGIANMOCUA TIME,
	SDT CHAR(10) CHECK (LEN(SDT)=10 AND SDT NOT LIKE '%[^0-9]%'),
	COBAIDOXE BIT,
	NHANVIENQUANLY CHAR(10),
	
	CONSTRAINT PK_CHINHANH
	PRIMARY KEY (MACHINHANH)
)

CREATE TABLE BANAN
(
	SOBAN VARCHAR(3) CHECK (SOBAN NOT LIKE '%[^0-9]%'),
	MACHINHANH CHAR(10),
	VITRI NVARCHAR(50),
	TRANGTHAI NVARCHAR(20),
	SONGUOITOIDA INT,

	CONSTRAINT PK_BANAN
	PRIMARY KEY (SOBAN, MACHINHANH)
)

CREATE TABLE DATCHO
(
	MADATCHO CHAR(10),
	NGAYDEN DATE,
	GIODEN TIME,
	SOLUONGKHACH INT,
	GHICHU NVARCHAR(MAX),
	SDT CHAR(10) CHECK (LEN(SDT)=10 AND SDT NOT LIKE '%[^0-9]%'),

	CONSTRAINT PK_DATCHO
	PRIMARY KEY (MADATCHO)
)

CREATE TABLE CHITIETDATCHO
(
	SOBAN VARCHAR(3),
	MACHINHANH CHAR(10),
	MADATCHO CHAR(10),
	SOLUONGKHACH INT,

	CONSTRAINT PK_CHITIETDATCHO
	PRIMARY KEY (SOBAN, MACHINHANH, MADATCHO)
)

CREATE TABLE NHANVIEN
(
	MANHANVIEN CHAR(10),
	HOTEN NVARCHAR(50),
	NGAYSINH DATE,
	GIOITINH NVARCHAR(3) CHECK (GIOITINH IN ('NAM','NỮ')),
	SDT CHAR(10) CHECK (LEN(SDT)=10 AND SDT NOT LIKE '%[^0-9]%'),
	DIACHI NVARCHAR(100),
	CHINHANHLAMVIEC CHAR(10),
	
	CONSTRAINT PK_NHANVIEN
	PRIMARY KEY (MANHANVIEN)
)

CREATE TABLE BOPHAN
(
	MABOPHAN CHAR(10),
	MACHINHANH CHAR(10),
	TENBOPHAN NVARCHAR(50),
	LUONG FLOAT,
	QUANLYBOPHAN CHAR(10),

	CONSTRAINT PK_BOPHAN
	PRIMARY KEY(MABOPHAN, MACHINHANH)
)

CREATE TABLE LICHSULAMVIEC
(
	MANHANVIEN CHAR(10),
	MABOPHAN CHAR(10),
	MACHINHANH CHAR(10),
	NGAYVAOLAM DATE,
	NGAYNGHIVIEC DATE,

	CONSTRAINT PK_LICHSULAMVIEC
	PRIMARY KEY(MANHANVIEN, MABOPHAN, MACHINHANH)
)

CREATE TABLE KHACHHANG
(
	MAKHACHHANG CHAR(10),
	HOTEN NVARCHAR(50),
	SDT CHAR(10) CHECK (LEN(SDT)=10 AND SDT NOT LIKE '%[^0-9]%'),
	EMAIL VARCHAR(30),
	CCCD VARCHAR(20),

	CONSTRAINT PK_KHACHHANNG
	PRIMARY KEY(MAKHACHHANG)
)

CREATE TABLE DANHGIA
(
	MADANHGIA CHAR(10),
	DIEMPHUCVU INT,
	DIEMVITRICHINHANH INT,
	DIEMKHONGGIAN INT,
	BINHLUAN NVARCHAR(400),
	KHACHHANGDANHGIA CHAR(10),
	CHINHANH CHAR(10),
	NHANVIEN CHAR(10),

	CONSTRAINT PK_DANHGIA
	PRIMARY KEY(MADANHGIA)
)

CREATE TABLE THETHANHVIEN
(
	MATHE CHAR(10),
	LOAITHE NVARCHAR(50),

	CONSTRAINT PK_THETHANHVIEN
	PRIMARY KEY(MATHE)
)

CREATE TABLE CHITIETKHACHHANG
(
	MAKHACHHANG CHAR(10),
	MATHE CHAR(10),
	NGAYDK DATE,
	DIEMTICHLUY INT,
	NGAYNANGHANG DATE,
	TRANGTHAITAIKHOAN NVARCHAR(50),
	NHANVIENTAOLAP CHAR(10),

	CONSTRAINT PK_CHITIETKHACHHAHG
	PRIMARY KEY(MAKHACHHANG, MATHE)
)

CREATE TABLE DANHGIAMONAN
(
	MADANHGIA CHAR(10),
	MAMON CHAR(10),
	DIEMCHATLUONGMONAN INT,
	DIEMGIACA INT,

	CONSTRAINT PK_DANHGIAMONAN
	PRIMARY KEY(MADANHGIA, MAMON)
)

ALTER TABLE HOADON
ADD
	CONSTRAINT FK_HOADON_THE
	FOREIGN KEY (BACTHETHANHVIEN)
	REFERENCES THETHANHVIEN(MATHE),

	CONSTRAINT FK_HOADON_KHUYENMAI
	FOREIGN KEY (MAKHUYENMAI)
	REFERENCES KHUYENMAI(MAKHUYENMAI)

ALTER TABLE DONDATMON
ADD
	CONSTRAINT FK_DONDATMON_HOADON
	FOREIGN KEY (HOADONLIENQUAN)
	REFERENCES HOADON(MAHOADON),

	CONSTRAINT FK_DONDATMON_KHACHHANG
	FOREIGN KEY (KHACHHANGDAT)
	REFERENCES KHACHHANG(MAKHACHHANG),

    CONSTRAINT FK_DONDATMON_DATCHO
	FOREIGN KEY (MADATCHO)
	REFERENCES DATCHO(MADATCHO),

    CONSTRAINT FK_DONDATMON_CHINHANH
	FOREIGN KEY (CHINHANHDAT)
	REFERENCES CHINHANH(MACHINHANH),

	CONSTRAINT FK_DONDATMON_NHANVIEN
	FOREIGN KEY (NHANVIENTAOLAP)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE DATHANGTRUCTUYEN
ADD
    CONSTRAINT PK_DATHANGTRUCTUYEN_DONDATMON
    FOREIGN KEY (MADHTRUCTUYEN)
    REFERENCES DONDATMON(MADON)

ALTER TABLE DATHANGTAICHO
ADD
    CONSTRAINT PK_DATHANGTAICHO_DONDATMON
    FOREIGN KEY (MADHTAICHO)
    REFERENCES DONDATMON(MADON),

    CONSTRAINT PK_DATHANGTAICHO_CHINHANH
    FOREIGN KEY (MACHINHANH)
    REFERENCES CHINHANH(MACHINHANH),

    CONSTRAINT PK_DATHANGTAICHO_SOBAN
    FOREIGN KEY (SOBAN)
    REFERENCES SOBAN(SOBAN)

ALTER TABLE NHANVIEN
ADD
	CONSTRAINT PK_NHANVIEN_CHINHANH
	FOREIGN KEY (CHINHANHLAMVIEC)
	REFERENCES CHINHANH(MACHINHANH)

ALTER TABLE BOPHAN
ADD
	CONSTRAINT PK_BOPHAN_CHINHANH
	FOREIGN KEY (MACHINHANH)
	REFERENCES CHINHANH(MACHINHANH),

	CONSTRAINT PK_BOPHAN_NHANVIEN
	FOREIGN KEY (QUANLYBOPHAN)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE LICHSULAMVIEC
ADD
	CONSTRAINT PK_LICHSULAMVIEC_BOPHAN
	FOREIGN KEY (MABOPHAN, MACHINHANH)
	REFERENCES BOPHAN(MABOPHAN, MACHINHANH),

	CONSTRAINT PK_LICHSULAMVIEC_NHANVIEN
	FOREIGN KEY (MANHANVIEN)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE DANHGIA
ADD
	CONSTRAINT PK_DANHGIA_KHACHHANG
	FOREIGN KEY (KHACHHANGDANHGIA)
	REFERENCES KHACHHANG(MAKHACHHANG),

	CONSTRAINT PK_DANHGIA_CHINHANH
	FOREIGN KEY (CHINHANH)
	REFERENCES CHINHANH(MACHINHANH),

	CONSTRAINT PK_DANHGIA_NHANVIEN
	FOREIGN KEY (NHANVIEN)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE CHITIETKHACHHANG
ADD
	CONSTRAINT FK_CHITIETKHACHHANG_KHACHHANG
	FOREIGN KEY (MAKHACHHANG)
	REFERENCES KHACHHANG(MAKHACHHANG),

	CONSTRAINT FK_CHITIETKHACHHANG_THETHANHVIEN
	FOREIGN KEY (MATHE)
	REFERENCES THETHANHVIEN(MATHE),

	CONSTRAINT FK_CHITIETKHACHHANG_NHANVIEN
	FOREIGN KEY (MANHANVIEN)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE DANHGIAMONAN
ADD
	CONSTRAINT FK_DANHGIAMONAN_DANHGIA
	FOREIGN KEY (MADANHGIA)
	REFERENCES DANHGIA(MADANHGIA),

	CONSTRAINT FK_DANHGIAMONAN_MONAN
	FOREIGN KEY (MAMON)
	REFERENCES MONAN(MAMON)

ALTER TABLE CHINHANH
ADD
	CONSTRAINT FK_CHINHANH_NHANVIENQUANLY
	FOREIGN KEY (NHANVIENQUANLY)
	REFERENCES NHANVIEN(MANHANVIEN)

ALTER TABLE BANAN
ADD
	CONSTRAINT FK_BANAN_MACHINHANH
	FOREIGN KEY (MACHINHANH)
	REFERENCES CHINHANH(MACHINHANH)

ALTER TABLE CHITIETDATCHO
ADD
	CONSTRAINT FK_CHITIETDATCHO_SOBAN_MACHINHANH
	FOREIGN KEY (SOBAN, MACHINHANH)
	REFERENCES BANAN(SOBAN, MACHINHANH),

	CONSTRAINT FK_CHITIETDATCHO_MADATCHO
	FOREIGN KEY (MADATCHO)
	REFERENCES DATCHO(MADATCHO)