generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id       Int      @id @default(autoincrement())
  username String   @unique
  password String
  email    String   @unique
  role     String   // Admin, Customer, Employee, Guest
  createdAt DateTime @default(now())
}

model BANAN {
  SOBAN         String          @db.VarChar(3)
  MACHINHANH    String          @db.Char(10)
  VITRI         String?         @db.NVarChar(50)
  TRANGTHAI     String          @db.NVarChar(20)
  SONGUOITOIDA  Int
  CHINHANH      CHINHANH        @relation(fields: [MACHINHANH], references: [MACHINHANH], onDelete: Cascade, onUpdate: NoAction, map: "FK_BANAN_MACHINHANH")
  CHITIETDATCHO CHITIETDATCHO[]
  DATHANGTAICHO DATHANGTAICHO[]

  @@id([SOBAN, MACHINHANH], map: "PK_BANAN")
}

model BOPHAN {
  MABOPHAN      String          @db.Char(10)
  MACHINHANH    String          @db.Char(10)
  TENBOPHAN     String          @db.NVarChar(50)
  LUONG         Float
  QUANLYBOPHAN  String?         @db.Char(10)
  CHINHANH      CHINHANH        @relation(fields: [MACHINHANH], references: [MACHINHANH], onDelete: NoAction, onUpdate: NoAction, map: "FK_BOPHAN_CHINHANH")
  NHANVIEN      NHANVIEN?       @relation(fields: [QUANLYBOPHAN], references: [MANHANVIEN], onUpdate: NoAction, map: "FK_BOPHAN_NHANVIEN")
  LICHSULAMVIEC LICHSULAMVIEC[]

  @@id([MABOPHAN, MACHINHANH], map: "PK_BOPHAN")
}

model CHINHANH {
  MACHINHANH                                  String      @id(map: "PK_CHINHANH") @db.Char(10)
  TENCHINHANH                                 String      @db.NVarChar(50)
  DIACHI                                      String      @db.NVarChar(100)
  KHUVUC                                      String      @db.NVarChar(50)
  THOIGIANMOCUA                               DateTime    @db.Time
  THOIGIANDONGCUA                             DateTime    @db.Time
  SDT                                         String?     @db.Char(10)
  EMAIL                                       String?     @db.VarChar(100)
  COBAIDOXE                                   Boolean
  NHANVIENQUANLY                              String?     @db.Char(10)
  BANAN                                       BANAN[]
  BOPHAN                                      BOPHAN[]
  NHANVIEN_CHINHANH_NHANVIENQUANLYToNHANVIEN  NHANVIEN?   @relation("CHINHANH_NHANVIENQUANLYToNHANVIEN", fields: [NHANVIENQUANLY], references: [MANHANVIEN], onUpdate: NoAction, map: "FK_CHINHANH_NHANVIENQUANLY")
  DANHGIA_DANHGIA_CHINHANHToCHINHANH          DANHGIA[]   @relation("DANHGIA_CHINHANHToCHINHANH")
  DONDATMON                                   DONDATMON[]
  HOADON                                      HOADON[]
  MENU                                        MENU[]
  NHANVIEN_NHANVIEN_CHINHANHLAMVIECToCHINHANH NHANVIEN[]  @relation("NHANVIEN_CHINHANHLAMVIECToCHINHANH")
}

model CHITIETDATCHO {
  SOBAN        String @db.VarChar(3)
  MACHINHANH   String @db.Char(10)
  MADATCHO     String @db.Char(10)
  SOLUONGKHACH Int?
  DATCHO       DATCHO @relation(fields: [MADATCHO], references: [MADATCHO], onDelete: Cascade, onUpdate: NoAction, map: "FK_CHITIETDATCHO_MADATCHO")
  BANAN        BANAN  @relation(fields: [SOBAN, MACHINHANH], references: [SOBAN, MACHINHANH], onDelete: Cascade, onUpdate: NoAction, map: "FK_CHITIETDATCHO_SOBAN_MACHINHANH")

  @@id([SOBAN, MACHINHANH, MADATCHO], map: "PK_CHITIETDATCHO")
}

model CHITIETKHACHHANG {
  MAKHACHHANG       String       @db.Char(10)
  MATHE             String       @db.Char(10)
  NGAYDK            DateTime     @db.Date
  DIEMTICHLUY       Int
  NGAYNANGHANG      DateTime     @db.Date
  TRANGTHAITAIKHOAN String       @db.NVarChar(50)
  NHANVIENTAOLAP    String       @db.Char(10)
  KHACHHANG         KHACHHANG    @relation(fields: [MAKHACHHANG], references: [MAKHACHHANG], onUpdate: NoAction, map: "FK_CHITIETKHACHHANG_KHACHHANG")
  NHANVIEN          NHANVIEN     @relation(fields: [NHANVIENTAOLAP], references: [MANHANVIEN], onUpdate: NoAction, map: "FK_CHITIETKHACHHANG_NHANVIEN")
  THETHANHVIEN      THETHANHVIEN @relation(fields: [MATHE], references: [MATHE], onUpdate: NoAction, map: "FK_CHITIETKHACHHANG_THETHANHVIEN")

  @@id([MAKHACHHANG, MATHE], map: "PK_CHITIETKHACHHAHG")
}

model CHITIETMONAN {
  MACTMON     String     @id(map: "PK_CHITIETMONAN") @db.Char(10)
  MAMENU      String?    @db.Char(10)
  SOLUONG     Int
  GHICHU      String?    @db.NVarChar(Max)
  DONGIATONG  Float?
  MADONDATMON String?    @db.Char(10)
  DONDATMON   DONDATMON? @relation(fields: [MADONDATMON], references: [MADON], onDelete: NoAction, onUpdate: NoAction, map: "FK_CHITIETMONAN_DONDATMON")
  MENU        MENU?      @relation(fields: [MAMENU], references: [MAMENU], onDelete: Cascade, onUpdate: NoAction, map: "FK_CHITIETMONAN_MAMENU")
}

model COMBOMONAN {
  MACOMBO          String             @id(map: "PK_COMBOMONAN") @db.Char(10)
  TENCOMBO         String             @db.NVarChar(50)
  MOTACOMBO        String?            @db.NVarChar(Max)
  MENU             MENU[]
  MONAN_COMBOMONAN MONAN_COMBOMONAN[]
}

model DANHGIA {
  MADANHGIA                           String         @id(map: "PK_DANHGIA") @db.Char(10)
  DIEMPHUCVU                          Int
  DIEMVITRICHINHANH                   Int
  DIEMKHONGGIAN                       Int
  BINHLUAN                            String?        @db.NVarChar(Max)
  KHACHHANGDANHGIA                    String?        @db.Char(10)
  CHINHANH                            String         @db.Char(10)
  NHANVIEN                            String?        @db.Char(10)
  MADON                               String?        @db.Char(10)
  CHINHANH_DANHGIA_CHINHANHToCHINHANH CHINHANH       @relation("DANHGIA_CHINHANHToCHINHANH", fields: [CHINHANH], references: [MACHINHANH], onDelete: NoAction, onUpdate: NoAction, map: "FK_DANHGIA_CHINHANH")
  DONDATMON                           DONDATMON?     @relation(fields: [MADON], references: [MADON], onDelete: NoAction, onUpdate: NoAction, map: "FK_DANHGIA_DONDATMON")
  KHACHHANG                           KHACHHANG?     @relation(fields: [KHACHHANGDANHGIA], references: [MAKHACHHANG], onUpdate: NoAction, map: "FK_DANHGIA_KHACHHANG")
  NHANVIEN_DANHGIA_NHANVIENToNHANVIEN NHANVIEN?      @relation("DANHGIA_NHANVIENToNHANVIEN", fields: [NHANVIEN], references: [MANHANVIEN], onUpdate: NoAction, map: "FK_DANHGIA_NHANVIEN")
  DANHGIAMONAN                        DANHGIAMONAN[]
}

model DANHGIAMONAN {
  MADANHGIA          String  @db.Char(10)
  MAMON              String  @db.Char(10)
  DIEMCHATLUONGMONAN Int
  DIEMGIACA          Int
  DANHGIA            DANHGIA @relation(fields: [MADANHGIA], references: [MADANHGIA], onDelete: Cascade, onUpdate: NoAction, map: "FK_DANHGIAMONAN_DANHGIA")
  MONAN              MONAN   @relation(fields: [MAMON], references: [MAMON], onDelete: Cascade, onUpdate: NoAction, map: "FK_DANHGIAMONAN_MONAN")

  @@id([MADANHGIA, MAMON], map: "PK_DANHGIAMONAN")
}

model DATCHO {
  MADATCHO      String          @id(map: "PK_DATCHO") @db.Char(10)
  NGAYDEN       DateTime        @db.Date
  GIODEN        DateTime        @db.Time
  SOLUONGKHACH  Int
  GHICHU        String?         @db.NVarChar(Max)
  SDT           String          @db.Char(10)
  CHITIETDATCHO CHITIETDATCHO[]
  DONDATMON     DONDATMON[]
}

model DATHANGTAICHO {
  MADHTAICHO String    @id(map: "PK_DATHANGTAICHO") @db.Char(10)
  MACHINHANH String?   @db.Char(10)
  SOBAN      String?   @db.VarChar(3)
  DONDATMON  DONDATMON @relation(fields: [MADHTAICHO], references: [MADON], onUpdate: NoAction, map: "FK_DATHANGTAICHO_DONDATMON")
  BANAN      BANAN?    @relation(fields: [SOBAN, MACHINHANH], references: [SOBAN, MACHINHANH], onDelete: NoAction, onUpdate: NoAction, map: "PK_DATHANGTAICHO_BANAN")
}

model DATHANGTRUCTUYEN {
  MADHTRUCTUYEN String    @id(map: "PK_DATHANGTRUCTUYEN") @db.Char(10)
  THOIGIANGIAO  DateTime  @db.Time
  DIACHIGIAO    String    @db.NVarChar(100)
  TRANGTHAIGIAO String    @db.NVarChar(20)
  DONDATMON     DONDATMON @relation(fields: [MADHTRUCTUYEN], references: [MADON], onUpdate: NoAction, map: "FK_DATHANGTRUCTUYEN_DONDATMON")
  TRUYCAP       TRUYCAP[]
}

model DONDATMON {
  MADON            String            @id(map: "PK_DONDATMON") @db.Char(10)
  GIODAT           DateTime          @db.Time
  NGAYDAT          DateTime          @db.Date
  TRANGTHAI        String            @db.NVarChar(20)
  LOAIDONDATMON    String            @db.NVarChar(20)
  HOADONLIENQUAN   String?           @db.Char(10)
  KHACHHANGDAT     String?           @db.Char(10)
  MADATCHO         String?           @db.Char(10)
  CHINHANHDAT      String            @db.Char(10)
  NHANVIENTAOLAP   String?           @db.Char(10)
  THANHTIEN        Float?
  CHITIETMONAN     CHITIETMONAN[]
  DANHGIA          DANHGIA[]
  DATHANGTAICHO    DATHANGTAICHO?
  DATHANGTRUCTUYEN DATHANGTRUCTUYEN?
  CHINHANH         CHINHANH          @relation(fields: [CHINHANHDAT], references: [MACHINHANH], onDelete: Cascade, onUpdate: NoAction, map: "FK_DONDATMON_CHINHANH")
  DATCHO           DATCHO?           @relation(fields: [MADATCHO], references: [MADATCHO], onUpdate: NoAction, map: "FK_DONDATMON_DATCHO")
  HOADON           HOADON?           @relation(fields: [HOADONLIENQUAN], references: [MAHOADON], onDelete: NoAction, onUpdate: NoAction, map: "FK_DONDATMON_HOADON")
  KHACHHANG        KHACHHANG?        @relation(fields: [KHACHHANGDAT], references: [MAKHACHHANG], onUpdate: NoAction, map: "FK_DONDATMON_KHACHHANG")
  NHANVIEN         NHANVIEN?         @relation(fields: [NHANVIENTAOLAP], references: [MANHANVIEN], onDelete: NoAction, onUpdate: NoAction, map: "FK_DONDATMON_NHANVIEN")
}

model HOADON {
  MAHOADON        String      @id(map: "PK_HOADON") @db.Char(10)
  GIOLAP          DateTime    @db.Time
  NGAYLAP         DateTime    @db.Date
  VAT             Float?      @default(0.08, map: "DF__HOADON__VAT__656C112C")
  TIENKHACHDUA    Float
  TRANGTHAI       String      @db.NVarChar(20)
  PHUONGTHUC      String      @db.NVarChar(20)
  MAKHACHHANG     String?     @db.Char(10)
  MACHINHANH      String?     @db.Char(10)
  TONGTIENTRUOCKM Float?
  TONGTIENSAUKM   Float?
  DONDATMON       DONDATMON[]
  CHINHANH        CHINHANH?   @relation(fields: [MACHINHANH], references: [MACHINHANH], onUpdate: NoAction, map: "FK_HOADON_CHINHANH")
  KHACHHANG       KHACHHANG?  @relation(fields: [MAKHACHHANG], references: [MAKHACHHANG], onUpdate: NoAction, map: "FK_HOADON_KHACHHANG")
}

model KHACHHANG {
  MAKHACHHANG        String               @id(map: "PK_KHACHHANNG") @db.Char(10)
  HOTEN              String               @db.NVarChar(50)
  SDT                String?              @db.Char(10)
  EMAIL              String?              @db.VarChar(100)
  CCCD               String?              @db.VarChar(20)
  CHITIETKHACHHANG   CHITIETKHACHHANG[]
  DANHGIA            DANHGIA[]
  DONDATMON          DONDATMON[]
  HOADON             HOADON[]
  KHUYENMAIKHACHHANG KHUYENMAIKHACHHANG[]
}

model KHUYENMAI {
  MAKHUYENMAI           String                 @id(map: "PK_KHUYENMAI") @db.Char(10)
  THONGTINKHUYENMAI     String?                @db.NVarChar(Max)
  LOAIKHUYENMAI         String                 @db.NVarChar(20)
  KHUYENMAIKHACHHANG    KHUYENMAIKHACHHANG?
  KHUYENMAITHETHANHVIEN KHUYENMAITHETHANHVIEN?
}

model KHUYENMAIKHACHHANG {
  MAKHUYENMAI    String     @id(map: "PK_KHUYENMAIKHACHHANG") @db.Char(10)
  TRANGTHAIDUNG  Boolean
  MAKHACHHANG    String?    @db.Char(10)
  NGAYBATDAU     DateTime   @db.Date
  NGAYKETTHUC    DateTime   @db.Date
  GIATRITOITHIEU Float
  LUONGKMTIEN    Float
  KHACHHANG      KHACHHANG? @relation(fields: [MAKHACHHANG], references: [MAKHACHHANG], onUpdate: NoAction, map: "FK_KHUYENMAIKHACHHANG_MAKHACHHANG")
  KHUYENMAI      KHUYENMAI  @relation(fields: [MAKHUYENMAI], references: [MAKHUYENMAI], onDelete: Cascade, onUpdate: NoAction, map: "FK_KHUYENMAIKHACHHANG_MAKHUYENMAI")
}

model KHUYENMAITHETHANHVIEN {
  MAKHUYENMAI     String        @id(map: "PK_KHUYENMAITHETHANHVIEN") @db.Char(10)
  MATHE           String?       @db.Char(10)
  LUONGKMPHANTRAM Float
  KHUYENMAI       KHUYENMAI     @relation(fields: [MAKHUYENMAI], references: [MAKHUYENMAI], onDelete: Cascade, onUpdate: NoAction, map: "FK_KHUYENMAITHETHANHVIEN_MAKHUYENMAI")
  THETHANHVIEN    THETHANHVIEN? @relation(fields: [MATHE], references: [MATHE], onDelete: Cascade, onUpdate: NoAction, map: "FK_KHUYENMAITHETHANHVIEN_MATHE")
}

model LICHSULAMVIEC {
  MANHANVIEN   String    @db.Char(10)
  MABOPHAN     String    @db.Char(10)
  MACHINHANH   String    @db.Char(10)
  NGAYVAOLAM   DateTime  @db.Date
  NGAYNGHIVIEC DateTime? @db.Date
  HESOLUONG    Float
  BOPHAN       BOPHAN    @relation(fields: [MABOPHAN, MACHINHANH], references: [MABOPHAN, MACHINHANH], onDelete: Cascade, onUpdate: NoAction, map: "FK_LICHSULAMVIEC_BOPHAN")
  NHANVIEN     NHANVIEN  @relation(fields: [MANHANVIEN], references: [MANHANVIEN], onDelete: NoAction, onUpdate: NoAction, map: "FK_LICHSULAMVIEC_NHANVIEN")

  @@id([MANHANVIEN, MABOPHAN, MACHINHANH], map: "PK_LICHSULAMVIEC")
}

model MENU {
  MAMENU          String         @id(map: "PK_MENU") @db.Char(10)
  MACHINHANH      String?        @db.Char(10)
  MAMON           String?        @db.Char(10)
  MACOMBO         String?        @db.Char(10)
  GIAHIENTAI      Float?
  TRANGTHAIPHUCVU String         @db.NVarChar(20)
  CHITIETMONAN    CHITIETMONAN[]
  CHINHANH        CHINHANH?      @relation(fields: [MACHINHANH], references: [MACHINHANH], onDelete: Cascade, onUpdate: NoAction, map: "FK_MENU_CHINHANH")
  COMBOMONAN      COMBOMONAN?    @relation(fields: [MACOMBO], references: [MACOMBO], onDelete: Cascade, onUpdate: NoAction, map: "FK_MENU_COMBO")
  MONAN           MONAN?         @relation(fields: [MAMON], references: [MAMON], onDelete: Cascade, onUpdate: NoAction, map: "FK_MENU_MONAN")
}

model MONAN {
  MAMON            String             @id(map: "PK_MONAN") @db.Char(10)
  TENMON           String             @db.NVarChar(50)
  DANHMUC          String             @db.NVarChar(50)
  DANHGIAMONAN     DANHGIAMONAN[]
  MENU             MENU[]
  MONAN_COMBOMONAN MONAN_COMBOMONAN[]
}

model MONAN_COMBOMONAN {
  MACOMBO    String     @db.Char(10)
  MAMON      String     @db.Char(10)
  SOLUONG    Int
  COMBOMONAN COMBOMONAN @relation(fields: [MACOMBO], references: [MACOMBO], onDelete: Cascade, onUpdate: NoAction, map: "FK_MONAN_COMBOMONAN_MACOMBO")
  MONAN      MONAN      @relation(fields: [MAMON], references: [MAMON], onDelete: Cascade, onUpdate: NoAction, map: "FK_MONAN_COMBOMONAN_MAMON")

  @@id([MACOMBO, MAMON], map: "PK_MONAN_COMBOMONAN")
}

model NHANVIEN {
  MANHANVIEN                                  String             @id(map: "PK_NHANVIEN") @db.Char(10)
  HOTEN                                       String             @db.NVarChar(50)
  NGAYSINH                                    DateTime           @db.Date
  GIOITINH                                    String             @db.NVarChar(6)
  SDT                                         String?            @db.Char(10)
  EMAIL                                       String?            @db.VarChar(100)
  DIACHI                                      String             @db.NVarChar(100)
  CHINHANHLAMVIEC                             String?            @db.Char(10)
  LUONGHIENTAI                                Float?
  BOPHAN                                      BOPHAN[]
  CHINHANH_CHINHANH_NHANVIENQUANLYToNHANVIEN  CHINHANH[]         @relation("CHINHANH_NHANVIENQUANLYToNHANVIEN")
  CHITIETKHACHHANG                            CHITIETKHACHHANG[]
  DANHGIA_DANHGIA_NHANVIENToNHANVIEN          DANHGIA[]          @relation("DANHGIA_NHANVIENToNHANVIEN")
  DONDATMON                                   DONDATMON[]
  LICHSULAMVIEC                               LICHSULAMVIEC[]
  CHINHANH_NHANVIEN_CHINHANHLAMVIECToCHINHANH CHINHANH?          @relation("NHANVIEN_CHINHANHLAMVIECToCHINHANH", fields: [CHINHANHLAMVIEC], references: [MACHINHANH], onDelete: NoAction, onUpdate: NoAction, map: "FK_NHANVIEN_CHINHANH")
}

model THETHANHVIEN {
  MATHE                 String                  @id(map: "PK_THETHANHVIEN") @db.Char(10)
  LOAITHE               String                  @db.NVarChar(50)
  CHITIETKHACHHANG      CHITIETKHACHHANG[]
  KHUYENMAITHETHANHVIEN KHUYENMAITHETHANHVIEN[]
}

model TRUYCAP {
  MATRUYCAP        String           @db.Char(10)
  MADHTRUCTUYEN    String           @db.Char(10)
  THOIDIEMBATDAU   DateTime         @db.Date
  THOIDIEMKETTHUC  DateTime         @db.Date
  DATHANGTRUCTUYEN DATHANGTRUCTUYEN @relation(fields: [MADHTRUCTUYEN], references: [MADHTRUCTUYEN], onDelete: Cascade, onUpdate: NoAction, map: "FK_TRUYCAP_MADHTRUCTUYEN")

  @@id([MATRUYCAP, MADHTRUCTUYEN], map: "PK_TRUYCAP")
}
